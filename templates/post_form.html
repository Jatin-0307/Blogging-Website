{% extends "base.html" %}

{% block title %}{{ page_title }} - Flask Blog{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('posts.show_posts') }}">Posts</a></li>
                <li class="breadcrumb-item active">{{ page_title }}</li>
            </ol>
        </nav>

        <div class="card">
            <div class="card-header">
                <h2>{{ page_title }}</h2>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="title" class="form-label">Title <span class="text-danger">*</span></label>
                        <input type="text" 
                               class="form-control" 
                               id="title" 
                               name="title" 
                               value="{{ post.title if post else '' }}" 
                               required
                               maxlength="200">
                        <div class="form-text">
                            <span id="title-count">0</span>/200 characters
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="body" class="form-label">Content <span class="text-danger">*</span></label>
                        <textarea class="form-control" 
                                  id="body" 
                                  name="body" 
                                  rows="10" 
                                  required
                                  placeholder="Write your blog post content here...">{{ post.body if post else '' }}</textarea>
                        <div class="form-text">
                            <span id="body-count">0</span> characters
                        </div>
                    </div>

                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" 
                                   type="checkbox" 
                                   id="is_published" 
                                   name="is_published"
                                   value="1"
                                   {% if post and post.is_published %}checked{% endif %}>
                            <label class="form-check-label" for="is_published">
                                <strong>Publish now</strong>
                            </label>
                            <div class="form-text">
                                Uncheck to save as draft. You can publish it later.
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('posts.show_posts') }}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> 
                            {% if post %}Update Post{% else %}Create Post{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>

        {% if post %}
        <div class="mt-3">
            <small class="text-muted">
                Created: {{ post.created_at.strftime('%B %d, %Y at %I:%M %p') }}
                {% if post.updated_at != post.created_at %}
                    | Last updated: {{ post.updated_at.strftime('%B %d, %Y at %I:%M %p') }}
                {% endif %}
            </small>
        </div>
        {% endif %}
    </div>
</div>

<script>
// Character counting functionality
document.addEventListener('DOMContentLoaded', function() {
    const titleInput = document.getElementById('title');
    const bodyInput = document.getElementById('body');
    const titleCount = document.getElementById('title-count');
    const bodyCount = document.getElementById('body-count');

    function updateTitleCount() {
        const count = titleInput.value.length;
        titleCount.textContent = count;
        titleCount.className = count > 180 ? 'text-warning' : count > 200 ? 'text-danger' : '';
    }

    function updateBodyCount() {
        const count = bodyInput.value.length;
        bodyCount.textContent = count;
    }

    titleInput.addEventListener('input', updateTitleCount);
    bodyInput.addEventListener('input', updateBodyCount);

    // Initialize counts
    updateTitleCount();
    updateBodyCount();
});
</script>
{% endblock %}
